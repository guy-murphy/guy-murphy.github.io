<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>I come not to bury IoC but to praise it. | Weird Scenes Inside The Goldmine</title>
  <meta name="author" content="Guy Murphy">
  
  <meta name="description" content="Or, All elephants are grey, that’s grey, therefore that’s an elephant.
I have used Spring.NET since 2006 when I first used it as the backbone of an MV">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="I come not to bury IoC but to praise it."/>
  <meta property="og:site_name" content="Weird Scenes Inside The Goldmine"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Weird Scenes Inside The Goldmine" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Weird Scenes Inside The Goldmine</a>, <small>...an obscurely titled development blog.</small></h1>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="https://github.com/guy-murphy">Github</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-11-27T03:43:18.000Z"><a href="/2014/11/27/I-come-not-to-bury-IoC-but-to-praise-it/">Nov 27 2014</a></time>
      
      
  
    <h1 class="title">I come not to bury IoC but to praise it.</h1>
  

    </header>
    <div class="entry">
      
        <p>Or, <em>All elephants are grey, that’s grey, therefore that’s an elephant.</em></p>
<p>I have used Spring.NET since 2006 when I first used it as the backbone of an MVC framework and CMS on the .NET platform, and I have used it aggressively since and to this day, inducting several development teams into its use over that time.</p>
<p>I felt compelled to give my credentials there as a good card carrying developer, hip to current trends, who finds it almost unthinkable to write a non-trivial application without an IoC container. I feel compelled because this piece may be unfashionable and I’m kind of dimly aware could make me unpopular in the current development community in which I find myself. Nobody likes to voice an unpopular view. We fear others will think us stupid.</p>
<p>It’s important that any reader appreciate that I am writing as .NET developer, lead and architect working in London. There may well be wider applicability to my views, but I can’t know that, as my observations are based on… well, what I get to observe. Things may be similar where you are, but they may not.</p>
<h2 id="A_room_full_of_smart_people_wearing_bell-bottoms,_because…">A room full of smart people wearing bell-bottoms, because…</h2>
<p>I have found myself on more than one occasions saying to my developers, <em>“commercial software development is first and foremost a social activity before it is anything else”</em>. I’d been saying that (possibly while stroking my beard) for some time before I actually stopped to think about it, because I felt quite a level of conviction, before I really understood what I meant. </p>
<p>It’s not a terribly opaque statement, and it’s really quite obvious the moment you consider it… Before any code gets written, before any infrastructure is laid down, a bunch of people are going to make a whole bunch of decisions.  Throughout the development of an application, and through it’s support and maintenance a wide assortment of people are going negotiate between themselves what is right action and what is wrong action. The quality of those decisions will have a significant impact on the quality of the software and ultimately equate to pound signs either written in black or red.</p>
<p>There are libraries filled with books written on the subject of people and decision making by writers far more studied in the subject than myself. I want to focus for the moment on one specific aspect of groups of developers and architects making technical decisions together. The acceptance without scrutiny of self evident virtue received as common wisdom from a peer group. Known by the more plain speaking as <strong>Fashion</strong>.</p>
<p>There’s a couple of angles I could take at this and I may explore other areas later, but for now I want to drill into Inversion of Control and Dependency Injection a little, and the manner of it’s pervasive use in the .NET development community currently.</p>
<p>I’ll admit that’s a lot of packaging before getting to the content.</p>
<h2 id="Inversion_of_Control_(IoC)">Inversion of Control (IoC)</h2>
<p>So what is IoC? It’s almost impossible to answer that question without first asking <em>“when?”</em>, because the expected answer to that question in interview today is very different than those who coined the term would give.</p>
<blockquote>
<p><a href="http://martinfowler.com/articles/injection.html" target="_blank" rel="external">Martin Fowler</a> When these containers talk about how they are so useful because they implement “Inversion of Control” I end up very puzzled. Inversion of control is a common characteristic of frameworks, so saying that these lightweight containers are special because they use inversion of control is like saying my car is special because it has wheels.</p>
</blockquote>
<p>I am reminded of the fact that if more people read Fielding’s <a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven" target="_blank" rel="external">own comments on the application of REST</a>, there would be a lot fewer articles and books on REST, and far fewer applications calling themselves RESTful. Concepts percolate through the development community and in the same way the truth of an event in some distant foreign country will go through many changes before it reaches your tabloid front-page, so do concepts in software development before they end up in the blog post you’re reading.</p>
<p>If we’re not lazy however, we can go back to their root and origin.</p>
<blockquote>
<p><a href="http://www.laputan.org/drc/drc.html" target="_blank" rel="external">Ralph Johnson and Brian Foote</a> One important characteristic of a framework is that the methods defined by the user to tailor the framework will often be called from within the framework itself, rather than from the user’s application code. The framework often plays the role of the main program in coordinating and sequencing application activity. This <strong>inversion of control</strong> gives frameworks the power to serve as extensible skeletons. The methods supplied by the user tailor the generic algorithms defined in the framework for a particular application.</p>
</blockquote>
<p>That quote, which is referenced by Mr. Fowler’s writing on IoC and was written in 1988. If I can persuade you to read just one paper, please make it this one. </p>
<h3 id="What_is_IoC_trying_to_achieve?">What is IoC trying to achieve?</h3>
<p>Before we look at the ways in which IoC is in someway a special case, it is useful perhaps to consider what it shares in common with a broader approach.</p>
<p>IoC participates in a movement to develop techniques for more reusable code, along with a bunch of other principles to this end. One of the success criteria then for our employment of IoC then is the degree to which we attain code reuse.</p>
<p>The environment in which IoC grew-up code reuse was seen not just as a means of increasing productivity, it was seen as essential if systems were to be allowed to grow and evolve over time, without collapsing under their own weight of complexity. There’s a lot of talk of class libraries evolving into frameworks, and frameworks evolving from <a href="http://en.wikipedia.org/wiki/White_box_(software_engineering%29" target="_blank" rel="external">white box</a> systems to <a href="http://en.wikipedia.org/wiki/Black_box" target="_blank" rel="external">black box</a> as our understanding of a systems abstraction improve with experience. There’s importance given in the early talk of and around IoC to the human factor at play within development. Systems should it was thought change as our understanding as a group of people engaged with a problem domain changes. The system should evolve in tandem with our understanding of it.</p>
<p>This approach to software development as an evolving system requires a focus on decoupling of implementation from use, an aggressive focus on discrete interfaces, and an almost obsessive regard for component substitution (plug-ability).</p>
<p>This common goal is what IoC is meant to further, to yield systems resilient to change.</p>
<h3 id="So_what_is_IoC?">So what is IoC?</h3>
<p>It’s a lot of different things.</p>
<blockquote>
<p><a href="http://martinfowler.com/bliki/InversionOfControl.html" target="_blank" rel="external">Martin Fowler</a> There is some confusion these days over the meaning of inversion of control due to the rise of IoC containers; some people confuse the general principle here with the specific styles of inversion of control (such as dependency injection) that these containers use. The name is somewhat confusing (and ironic) since IoC containers are generally regarded as a competitor to EJB, yet EJB uses inversion of control just as much (if not more).</p>
</blockquote>
<p>Whoah. Something more IoC than an IoC Container?</p>
<p>One of the characteristics of the practice of religious faith, is that it often doesn’t stand up to scrutiny with its founding texts and prophets.</p>
<blockquote>
<p><a href="http://martinfowler.com/bliki/InversionOfControl.html" target="_blank" rel="external">Martin Fowler</a> Another way to do this is to have the framework define events and have the client code subscribe to these events. .NET is a good example of a platform that has language features to allow people to declare events on widgets. You can then bind a method to the event by using a delegate.</p>
</blockquote>
<p>You’ve been doing IoC for a long time, in a lot of different ways, long before you ever found <a href="http://www.ninject.org/" target="_blank" rel="external">Ninject</a>.</p>
<p>Inversion of Control is any pattern that inverts the traditional procedural flow of control. That’s it. The purpose of which is to reduce coupling between components to make them easier to swap out, and to promote flexible application evolution that is able to cope with new abstraction built from it.</p>
<h2 id="Just_because_your_mouse_is_grey_doesn’t_mean_it’s_an_elephant">Just because your mouse is grey doesn’t mean it’s an elephant</h2>
<p>Consider the following wee piece of code…</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">context.FireWith(<span class="string">"user-store::delete-user"</span>, <span class="string">"user-id"</span>);</div></pre></td></tr></table></figure>

<p>Which is a straight-up imperative call. We have the expectation that a named component will delete the user specified. It’s a message-based call, and there are valid aspects of decoupling taking place here, but it’s weak in terms of IoC as it’s a traditional forward calling imperative… <em>“Oi! You there, do that.”</em></p>
<p>Almost the same…</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">context.FireWith(<span class="string">"user-unsubscribed"</span>, <span class="string">"user-id"</span>);</div></pre></td></tr></table></figure>

<p>Here we are notifying the system of a significant occurrence. We may have no idea what if anything is going to happen as a side-effect of this. Several things may act upon this, or nothing may act upon this… and we don’t care, because in the second example it’s not our business at this point in the application. This is not an imperative. It’s notifying the broader system of an event… <em>“Excuse me. Anybody there? I don’t want to be a nuisance, but I just did something, and I thought somebody might want to know.”</em>… Henceforth to be known as <em>the English pattern</em>.</p>
<p>In the second example you can have many components responding to the message, each with a discrete narrow focus of purpose. It is open to easy extension by adding new components that will respond to the message, without modifying existing implementation or behaviour. It’s easy to swap out components for ones with different implementations, and the interface is small, discrete and generalised, binding is indirect and at runtime. Feature switching not just at compile time, but at runtime is possible. Lastly at this point in the code, we don’t concern ourself with what happens in the broader system, and require the least possible knowledge about the broader system.</p>
<p>We’re using exactly the same API call here, but this time our expectations are of a reactive response to this event. Here we have inverted the traditional flow of control. Both these calls will use exactly the same mechanic of resolution, but one expresses an inversion of control and one doesn’t.</p>
<p>That’s how narrow the divide can be between flow of control going forward or backwards. The defining factor on either side of that divide is one of intent. By intent I mean an implicit accord on both sides with a common expectation of the meaning of a signal. The balance of the roles and responsibilities in this relationship are for you to decide. It’s about your intent. The mechanism of that signal is important, but not as important as what is being expressed and what is expected. There’s lots of different ways you can use a delegate, many of them will invert control, but simply using a delegate will not get you inversion of control.</p>
<p>It ain’t what you do, it’s the way that you do it, and parroting patterns will not ensure that intent is fulfilled. Understanding intent is key here, as if we understand intent, as long as we’re half-decent developers, our implementations will improve over time and we’ll get there. If we don’t understand the initial intent, our chances of hitting the target are much reduced and start involving luck.</p>
<p>The pioneers laying down these principles did not expect it to be possible for groups of humans to land on the perfect abstraction straight out the gate. They talk about taking flawed initial implementations and iteratively improving our architectural choices. So unless you happen to be some kind of architectural genius that gets their abstractions right first time, a strategy for change becomes a strategy for survival.</p>
<h3 id="Javascript">Javascript</h3>
<p>I’m aware of where Javascript started with Netscape on the server, and I’m aware of where Javascript is today both with <a href="http://nodejs.org/" target="_blank" rel="external">NodeJS</a>. Javascript came of age however in the browser. This meant that Javascript grew up in an environment where the programmer was interacting with a framework (the browser) via an exposed object model.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">onclick</span>=<span class="value">"function(this){/* do something with 'this' */}"</span>&gt;</span></div></pre></td></tr></table></figure>

<p>That’s a good example of inversion of control. We’re registering a callback with an event the framework is going to raise for this element, with the execution of any callbacks managed by the framework. If we think of the alternative, we would need to modify the framework’s core functionality.</p>
<p>This naturally evolves to…</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">element.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{ alert(<span class="string">"Hello World!"</span>); });</div></pre></td></tr></table></figure>

<p>Javascript developers weren’t writing complete applications, they were integrating with a framework that forced them to accept IoC as the natural order of things. Modern Javascript frameworks reflect this heritage.</p>
<p>There’s any one of a rampaging horde of Javascript frameworks I could cite for example here, so don’t read too much in my choosing Twitter’s <a href="https://flightjs.github.io/" target="_blank" rel="external">Flight</a> to illustrate the point.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Component definition */</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> Inbox = flight.component(inbox);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">inbox</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">this</span>.doSomething = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="comment">/* ... */</span> }</div><div class="line">  <span class="keyword">this</span>.doSomethingElse = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="comment">/* ... */</span> }</div><div class="line"></div><div class="line">  <span class="comment">// after initializing the component</span></div><div class="line">  <span class="keyword">this</span>.after(<span class="string">'initialize'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">this</span>.on(<span class="string">'click'</span>, <span class="keyword">this</span>.doSomething);</div><div class="line">    <span class="keyword">this</span>.on(<span class="string">'mouseover'</span>, <span class="keyword">this</span>.doSomethingElse);</div><div class="line">  });</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* Attach the component to a DOM node */</span></div><div class="line"></div><div class="line">Inbox.attachTo(<span class="string">'#inbox'</span>);</div></pre></td></tr></table></figure>

<p>It’s not so much that Javascript has such laudable executions of IoC, it’s that the .NET development community has settled on such an anemic consensus on IoC.</p>
<h2 id="And_we’ve_not_mentioned_Dependency_Injection_(DI)_yet">And we’ve not mentioned Dependency Injection (DI) yet</h2>
<p>Because although it’s pervasive, it’s possibly the least interesting aspects of IoC while remaining one of the more convenient.</p>
<blockquote>
<p>In dependency injection, a dependent object or module is coupled to the object it needs at run time. <a href="http://en.wikipedia.org/wiki/Inversion_of_control" target="_blank" rel="external">http://en.wikipedia.org/wiki/Inversion_of_control</a></p>
</blockquote>
<p>Coupled to the object it needs. There is coupling taking place with DI that needs to be managed, and if it’s via constructor injection it’s not necessarily very loose.</p>
<p>I’m looking at an MVC.NET controller with 15 objects injected into it’s constructor. Most of them are repositories. I was intending to count the members of each of those objects, but the first one had 32 public members and I stopped counting there.</p>
<p>How loosely coupled do you think I feel looking at this code? How discrete are the responsibilities being exercised here do you think?</p>
<p>These objects are all injected into the controller by an IoC container. There is a huge surface area being exposed to this component regardless of which particular operation it is performing, with is possessing 27 public members itself.</p>
<p>Just because you are using an IoC container and DI does not mean you are implementing IoC. It just means you’ve found a convenient way to manage instantiation of objects. In my experience this convenience in wiring up components in unthoughtful ways has done considerable harm exhibited by the current swathe of MVC.NET + Entity Framework + Ninject web application all implemented quite cheerfully around SOLID principles.</p>
<blockquote>
<p><a href="http://www.laputan.org/drc/drc.html" target="_blank" rel="external">Ralph Johnson and Brian Foote</a> Sometimes it is hard to split a class into two parts because methods that should go in different classes access the same instance variable. This can happen because the instance variable is being treated as a global variable when it should be passed as a parameter between methods. Changing the methods to explicitly pass the parameter will make it easier to split the class later.</p>
</blockquote>
<p>Your use of the constructor is not inconsequential. I personally aim as much as possible to inject at the constructor only such configuration data as is necessary for that class of component to operate, regardless of implementation. I want as much as possible to be able to swap out implementations without altering their config. Remember that’s what we’re trying to achieve here.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">object</span> <span class="attribute">type</span>=<span class="value">"Conclave.Web.Behaviour.BootstrapBehaviour"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">index</span>=<span class="value">"message"</span> <span class="attribute">value</span>=<span class="value">"bootstrap"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">index</span>=<span class="value">"params"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">dictionary</span> <span class="attribute">key-type</span>=<span class="value">"string"</span> <span class="attribute">value-type</span>=<span class="value">"string"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">entry</span> <span class="attribute">key</span>=<span class="value">"area"</span> <span class="attribute">value</span>=<span class="value">"default"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">entry</span> <span class="attribute">key</span>=<span class="value">"concern"</span> <span class="attribute">value</span>=<span class="value">"default"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">entry</span> <span class="attribute">key</span>=<span class="value">"action"</span> <span class="attribute">value</span>=<span class="value">"default"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">entry</span> <span class="attribute">key</span>=<span class="value">"app-path"</span> <span class="attribute">value</span>=<span class="value">"/conclave.cms"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">dictionary</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">constructor-arg</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">object</span>&gt;</span></div></pre></td></tr></table></figure>

<p>We’re configuring behaviour here, regardless of the implementation what we are expressing in this configuration remains the same as our intent is the same. Although we are not obliged contractually we understand the spirit of our intent and try and keep our constructors as honest a part of our interface as possible.</p>
<p>This is DI, but it’s very much light-weight and focuses on configuring the component for use.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">object</span> <span class="attribute">type</span>=<span class="value">"Conclave.Web.Behaviour.View.XslViewBehaviour, Conclave.Web"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">name</span>=<span class="value">"message"</span> <span class="attribute">value</span>=<span class="value">"xslt::view"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">name</span>=<span class="value">"contentType"</span> <span class="attribute">value</span>=<span class="value">"text/xml"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">object</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">object</span> <span class="attribute">type</span>=<span class="value">"Conclave.Web.Behaviour.View.XslViewBehaviour, Conclave.Web"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">name</span>=<span class="value">"message"</span> <span class="attribute">value</span>=<span class="value">"xsl::view"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">name</span>=<span class="value">"contentType"</span> <span class="attribute">value</span>=<span class="value">"text/html"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">object</span>&gt;</span></div></pre></td></tr></table></figure>

<p>If a component uses rather than has another service for it’s operation it is an implementation detail and is acquired by service location. In this particular framework we care a lot about being able to swap out components, and ensure this intent is met.</p>
<p>In most cases I do not regard it as appropriate to inject something as fat and implementation specific as a repository into a behavioural component. Even though it may be DI, there are too many other principles in the balance that this violates.</p>
<h2 id="The_Dependency_Inversion_Principle_(DIP)">The Dependency Inversion Principle (DIP)</h2>
<p>The “D” in <a href="http://en.wikipedia.org/wiki/SOLID_(object-oriented_design%29" target="_blank" rel="external">SOLID</a> does not stand for Dependency Injection. It stands for the <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle" target="_blank" rel="external">Dependency inversion principle</a> which is a subtly different thing. And has a focus on implementing interface abstractions and using those interface abstractions.</p>
<blockquote>
<p>The goal of the dependency inversion principle is to decouple application glue code from application logic. Reusing low-level components (application logic) becomes easier and maintainability is increased. This is facilitated by the separation of high-level components and low-level components into separate packages/libraries, where interfaces defining the behavior/services required by the high-level component are owned by, and exist within the high-level component’s package. <strong>The implementation of the high-level component’s interface by the low level component requires that the low-level component package depend upon the high-level component for compilation, thus inverting the conventional dependency relationship</strong>. Various patterns such as Plugin, Service Locator, or Dependency Injection are then employed to facilitate the run-time provisioning of the chosen low-level component implementation to the high-level component. <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle" target="_blank" rel="external">http://en.wikipedia.org/wiki/Dependency_inversion_principle</a></p>
</blockquote>
<p>In Dependency Inversion, the implementing class is dependent on an interface that is either owned by an intermediary that the high level component is also dependent upon, or the interface is owned by the high level component. </p>
<p>Strictly speaking if the interface isn’t owned by the high level component, the dependency has not been inverted.</p>
<blockquote>
<p>In order to completely achieve dependency inversion, it is important to understand that the abstracted component, or the interface in this case, must be “owned” by the higher-level class. <a href="http://blog.appliedis.com/2013/12/10/lost-in-translation-dependency-inversion-principle-inversion-of-control-dependency-injection-service-locator/" target="_blank" rel="external">http://blog.appliedis.com/2013/12/10/lost-in-translation-dependency-inversion-principle-inversion-of-control-dependency-injection-service-locator/</a></p>
</blockquote>
<p>In Inversion and Conclave you’ll see occasionally a comment along the lines of <code>// we need to own this interface</code>. You’ll also see several BCL components being wrapped such as request and response objects. One of the gaols of Inversion is to be easily portable to other platforms, and so it is important to control what interfaces the framework exposes.</p>
<p>We don’t notice this for the most part in everyday development as a lot of our interface abstractions are picked up by the .NET base class library. If I have a low level component implementing <code>IList</code> and a high level component consuming is via <code>IList</code>, we take the stewardship of the interface by the BCL as good-enough, and quite reasonably don’t get too pedantic over the fact this isn’t DIP as the high level component doesn’t own the interface. A stable and neutral third-party is often anointed by the high level component. That example is a little contrived for simplicity as lists are not the kind of components we would normally engage this level of concern over, but more valid examples are to be found in the <code>System.Data</code> namespace.</p>
<p>This principle can quickly get quite fiddly in practice so often its pragmatically summarised as <em>“don’t use concretes”</em>, which gives 80% of its goodness, but not all.</p>
<p>Consider the use of the <code>Newtonsoft.Json</code> package. It’s such a brilliant package that it’s used extensively. When a high level component couples with these interfaces it becomes dependent on them in the traditional way. You don’t control those interfaces, Newtonsoft do. In most cases use of such foreign interfaces should be implementation detail that is not exposed to the broader framework.</p>
<p>But there’s a way to dodge most of the issues with DIP entirely, and that is to not use lower level components directly. Instead model the interactions the high level component needs to have with the low level components, treat them as pluggable black-boxes, and only interact with them via an intermediary interface with the framework responsible for resolving that interaction. Messaging is a good example of this, as were the two snippets of code earlier in this piece.</p>
<h2 id="Fashion">Fashion</h2>
<p>When a room full of smart people to turn MVC.NET + Entity Framework + Ninject into a the exact opposite of what IoC is trying to achieve, which is to say a rats nest of dependencies, leaking knowledge all over the place, with components coupling like a Roman orgy, we have to ask ourselves how and why?</p>
<p>The best answer I can come up with is fashion.</p>
<p>That’s not to be dismissive or derisory. To be so would only compound the issue. It is to acknowledge that we can see and accept the role of fashion in almost every human endevour, and to suggest that we may need to consider how it impacts our technical choices.</p>
<p>We all have a very real need to feel the support and approval of our peers. It’s not a mild passing influence, it’s wired deep into us as a survival strategy as an animal. As we occupy the more geekish end of the spectrum we tend to seek our approval through demonstrating what we know. Moreover it’s the means by which we earn our living. Saying <em>“I don’t know”</em>, does not necessarily come easy to us.</p>
<p>DIP causes me problems. I disagree in part with some of it’s intent. I don’t want my low level components knowing anything about my higher level components. I have no intention of doing that. That bit of DIP looks like nonsense to me.</p>
<p>When I make that assertion I know a couple of things. The Dependency inversion principle was cooked up by some very smart and well studied people. Given that, there is the distinct possibility that I am missing something. The confusion I feel when considering some aspects of DIP further lends weight to this. If I’m sat in a room of my peers, I risk looking foolish if I express my confusion.</p>
<p>Now imagine I’m a team lead or architect. I’m getting paid to know what I’m doing, and my ability to lead and instruct my team is dependent on their respect for my technical ability. I am making myself vulnerable when I admit to my team that I am experiencing confusion with some methods of application of an architectural principle that the whole .NET community seem to have accepted as principle. It might be easier to just pretend I know, and then to cover my inadequacy coach my team in my version and understanding of DIP as the real thing.</p>
<p>This is how fashionable decisions are made. When the goal becomes to be seen by our peers as “good developers” we are engaged in a social exercise and the technical merits of our choices become secondary.</p>
<p>In every case where I have observed this happening it is either an absence of a team lead, or a failure on the part of the team lead to establish the safety for simple human honesty. Further a failure to acknowledge that despite best intentions we are very fallible, and intellectual honesty needs to be motivated. The technical impact of this is we end up wearing principles like IoC like a fashion accessory with very little honest endevour given to it’s underlying intent.</p>
<p>IoC is great. On the .NET platform it’s a particularly interesting time with so much growth in reactive features on the platform, and the TPL. IoC as it exists currently in commercial web application development on the .NET platform has more to do I would suggest with fashion than anything of substance.</p>

      
    </div>
    <footer>
      
        
        
      
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:guy-murphy.guthub.io">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/blog/">blog</a><small>1</small></li>
  
    <li><a href="/tags/inversion/">inversion</a><small>3</small></li>
  
    <li><a href="/tags/patterns/">patterns</a><small>2</small></li>
  
    <li><a href="/tags/tools/">tools</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Guy Murphy
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'guy-murphy';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>